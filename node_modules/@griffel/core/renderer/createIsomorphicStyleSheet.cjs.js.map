{"version":3,"file":"createIsomorphicStyleSheet.cjs.js","sources":["../../../../packages/core/src/renderer/createIsomorphicStyleSheet.ts"],"sourcesContent":["import { DATA_BUCKET_ATTR, DATA_PRIORITY_ATTR } from '../constants';\nimport type { IsomorphicStyleSheet, StyleBucketName } from '../types';\n\nexport function createIsomorphicStyleSheet(\n  styleElement: HTMLStyleElement | undefined,\n  bucketName: StyleBucketName,\n  priority: number,\n  elementAttributes: Record<string, string>,\n): IsomorphicStyleSheet {\n  // no CSSStyleSheet in SSR, just append rules here for server render\n  const __cssRulesForSSR: string[] = [];\n\n  elementAttributes[DATA_BUCKET_ATTR] = bucketName;\n  elementAttributes[DATA_PRIORITY_ATTR] = String(priority);\n\n  if (styleElement) {\n    for (const attrName in elementAttributes) {\n      styleElement.setAttribute(attrName, elementAttributes[attrName]);\n    }\n  }\n\n  function insertRule(rule: string) {\n    if (styleElement?.sheet) {\n      return styleElement.sheet.insertRule(rule, styleElement.sheet.cssRules.length);\n    }\n\n    return __cssRulesForSSR.push(rule);\n  }\n\n  return {\n    elementAttributes,\n    insertRule,\n    element: styleElement,\n    bucketName,\n    cssRules() {\n      if (styleElement?.sheet) {\n        return Array.from(styleElement.sheet.cssRules).map(cssRule => cssRule.cssText);\n      }\n\n      return __cssRulesForSSR;\n    },\n  };\n}\n\nexport function createIsomorphicStyleSheetFromElement(element: HTMLStyleElement) {\n  const elementAttributes = Array.from(element.attributes).reduce((acc, attr) => {\n    acc[attr.name] = attr.value;\n    return acc;\n  }, {} as Record<string, string>);\n  const stylesheet = createIsomorphicStyleSheet(\n    element,\n    elementAttributes[DATA_BUCKET_ATTR] as StyleBucketName,\n    Number(elementAttributes[DATA_PRIORITY_ATTR]),\n    elementAttributes,\n  );\n  return stylesheet;\n}\n"],"names":["createIsomorphicStyleSheet","styleElement","bucketName","priority","elementAttributes","__cssRulesForSSR","DATA_BUCKET_ATTR","DATA_PRIORITY_ATTR","String","attrName","setAttribute","insertRule","rule","sheet","cssRules","length","push","element","Array","from","map","cssRule","cssText","createIsomorphicStyleSheetFromElement","attributes","reduce","acc","attr","name","value","stylesheet","Number"],"mappings":";;;;AAGM,SAAUA,0BAA0BA,CACxCC,YAA0C,EAC1CC,UAA2B,EAC3BC,QAAgB,EAChBC,iBAAyC,EAAA;AAEzC;EACA,MAAMC,gBAAgB,GAAa,EAAE,CAAA;AAErCD,EAAAA,iBAAiB,CAACE,0BAAgB,CAAC,GAAGJ,UAAU,CAAA;AAChDE,EAAAA,iBAAiB,CAACG,4BAAkB,CAAC,GAAGC,MAAM,CAACL,QAAQ,CAAC,CAAA;AAExD,EAAA,IAAIF,YAAY,EAAE;AAChB,IAAA,KAAK,MAAMQ,QAAQ,IAAIL,iBAAiB,EAAE;MACxCH,YAAY,CAACS,YAAY,CAACD,QAAQ,EAAEL,iBAAiB,CAACK,QAAQ,CAAC,CAAC,CAAA;AAClE,KAAA;AACF,GAAA;EAEA,SAASE,UAAUA,CAACC,IAAY,EAAA;AAC9B,IAAA,IAAIX,YAAY,aAAZA,YAAY,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAZA,YAAY,CAAEY,KAAK,EAAE;AACvB,MAAA,OAAOZ,YAAY,CAACY,KAAK,CAACF,UAAU,CAACC,IAAI,EAAEX,YAAY,CAACY,KAAK,CAACC,QAAQ,CAACC,MAAM,CAAC,CAAA;AAChF,KAAA;AAEA,IAAA,OAAOV,gBAAgB,CAACW,IAAI,CAACJ,IAAI,CAAC,CAAA;AACpC,GAAA;EAEA,OAAO;IACLR,iBAAiB;IACjBO,UAAU;AACVM,IAAAA,OAAO,EAAEhB,YAAY;IACrBC,UAAU;AACVY,IAAAA,QAAQA,GAAA;AACN,MAAA,IAAIb,YAAY,aAAZA,YAAY,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAZA,YAAY,CAAEY,KAAK,EAAE;AACvB,QAAA,OAAOK,KAAK,CAACC,IAAI,CAAClB,YAAY,CAACY,KAAK,CAACC,QAAQ,CAAC,CAACM,GAAG,CAACC,OAAO,IAAIA,OAAO,CAACC,OAAO,CAAC,CAAA;AAChF,OAAA;AAEA,MAAA,OAAOjB,gBAAgB,CAAA;AACzB,KAAA;GACD,CAAA;AACH,CAAA;AAEM,SAAUkB,qCAAqCA,CAACN,OAAyB,EAAA;AAC7E,EAAA,MAAMb,iBAAiB,GAAGc,KAAK,CAACC,IAAI,CAACF,OAAO,CAACO,UAAU,CAAC,CAACC,MAAM,CAAC,CAACC,GAAG,EAAEC,IAAI,KAAI;IAC5ED,GAAG,CAACC,IAAI,CAACC,IAAI,CAAC,GAAGD,IAAI,CAACE,KAAK,CAAA;AAC3B,IAAA,OAAOH,GAAG,CAAA;GACX,EAAE,EAA4B,CAAC,CAAA;EAChC,MAAMI,UAAU,GAAG9B,0BAA0B,CAC3CiB,OAAO,EACPb,iBAAiB,CAACE,0BAAgB,CAAoB,EACtDyB,MAAM,CAAC3B,iBAAiB,CAACG,4BAAkB,CAAC,CAAC,EAC7CH,iBAAiB,CAClB,CAAA;AACD,EAAA,OAAO0B,UAAU,CAAA;AACnB;;;;;"}